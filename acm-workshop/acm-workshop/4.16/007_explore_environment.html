<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Deploying Clusters using Hosted Control Planes :: Clusters and Governance</title>
    <meta name="generator" content="Antora 2.3.4">
    <link rel="stylesheet" href="../../_/css/site.css">
<link rel="icon" href="../../_/img/favicon.ico" type="image/x-icon">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  </head>
  <body class="article">
<header class="header">
  <script type="text/javascript">
    document.addEventListener('DOMContentLoaded', function () { 
      const urlParams = new URLSearchParams(window.location.search);
      const clusterName = urlParams.get('CLUSTER_SUBDOMAIN');
      const projectName = urlParams.get('PROJECT');
      if (clusterName) {
        showCluster( clusterName );
      }
      else {
        showClusterForm();
      }

      if (projectName) {
        showProject( projectName );
      } else {
        showProjectForm();
      }
    } );


    function sliceCluster(clusterName){
      if (clusterName.length > 70) {
          return "..." + clusterName.slice(35);
      } else {
          return clusterName;
      }
    }

    function showCluster( clusterName ) {
      document.getElementById('navbar-form-empty').style.display = "none";
      document.getElementById('navbar-form-filled').style.display = "flex";
      document.getElementById('cluster_subdomain').textContent = sliceCluster(clusterName);
      document.getElementById('clusterfield2').value = clusterName;

    }

    function showClusterForm( clusterName ) {
      document.getElementById('navbar-form-empty').style.display = "flex";
      document.getElementById('navbar-form-filled').style.display = "none";
    }

    function gowithcluster() {
      elClusterInput = document.getElementById('clusterfield');
      elProjectInput = document.getElementById('projectfield2');

      window.location.search = ('&CLUSTER_SUBDOMAIN=' + elClusterInput.value + '&PROJECT=' + elProjectInput.value);
    }

    function showProject( projectName ) {
      document.getElementById('navbar-form-project-empty').style.display = "none";
      document.getElementById('navbar-form-project-filled').style.display = "flex";
      document.getElementById('project').textContent = projectName;
      document.getElementById('projectfield2').value = projectName;
    }

    function showProjectForm( projectName ) {
      document.getElementById('navbar-form-project-empty').style.display = "flex";
      document.getElementById('navbar-form-project-filled').style.display = "none";
    }

    function gowithproject() {
      elProjectInput = document.getElementById('projectfield');
      elClusterInput = document.getElementById('clusterfield2');
      window.location.search = ('&CLUSTER_SUBDOMAIN=' + elClusterInput.value + '&PROJECT=' + elProjectInput.value);
    }

  </script>
  <nav class="navbar">
    <div class="navbar-brand">
      <a class="navbar-item" href="https://developers.redhat.com" target="_blank"><img
          src="../../_/img/header_logo.png" height="40px" alt="Red Hat Developer Program"></a>
      <a class="navbar-item" href="../..">Clusters and Governance</a>
      <button class="navbar-burger" data-target="topbar-nav">
        <span></span>
        <span></span>
        <span></span>
      </button>
    </div>
    <div id="topbar-nav" class="navbar-menu">
      <div class="navbar-end">
        <div class="navbar-item" id="navbar-form-empty">
          <span class="navbar-text" style="margin-left: 1rem; margin-right: 1rem;">&nbsp;<i style="color: orange;"
              class="fa fa-exclamation-triangle" aria-hidden="true"></i></span>

          <form action="javascript:void(0);" onsubmit="gowithcluster();">
            <input size="40" id="clusterfield" type="text" placeholder="Enter Cluster Subdomain">
            <input type="hidden" id="projectfield2" name="projectfield2" value="">
          </form>
        </div>

        <div class="navbar-item" id="navbar-form-filled" style="display: none;">
          <span class="navbar-text" style="margin-left: 1rem; margin-right: 1rem;">|</span>
          <span class="navbar-text" id="cluster_subdomain"></span>
          <span class="navbar-text" style="margin-left: 1rem; margin-right: 1rem;">&nbsp;<i onclick="recycle();" style="color: green;" class="fa fa-recycle" aria-hidden="true"></i></span>
        </div>

         <div class="navbar-item" id="navbar-form-project-empty">
          <span class="navbar-text" style="margin-left: 1rem; margin-right: 1rem;">&nbsp;<i style="color: orange;"
              class="fa fa-exclamation-triangle" aria-hidden="true"></i></span>

          <form action="javascript:void(0);" onsubmit="gowithproject();">
            <input size="40" id="projectfield" type="text" placeholder="Enter Project Name">
            <input type="hidden" id="clusterfield2" name="clusterfield2" value="">
          </form>
        </div>

        <div class="navbar-item" id="navbar-form-project-filled" style="display: none;">
          <span class="navbar-text" style="margin-left: 1rem; margin-right: 1rem;">|</span>
          <span class="navbar-text" id="project"></span>
          <span class="navbar-text" style="margin-left: 1rem; margin-right: 1rem;">&nbsp;<i onclick="recycle();" style="color: green;" class="fa fa-recycle" aria-hidden="true"></i></span>
        </div>
<!---
        <a class="navbar-item" href="https://developers.redhat.com/ebooks/" target="_blank">Books</a>
        <a class="navbar-item" href="https://developers.redhat.com/cheatsheets/" target="_blank">Cheat Sheets</a>
        <a class="navbar-item" href="https://developers.redhat.com/events/" target="_blank">Upcoming Events</a>
        <div class="navbar-item has-dropdown is-hoverable">
          <a class="navbar-link" href="#">More Tutorials</a>
          <div class="navbar-dropdown">
            <a class="navbar-item" href="https://redhat-scholars.github.io/kubernetes-tutorial/" target="_blank">Kubernetes</a>
            <a class="navbar-item" href="https://redhat-scholars.github.io/istio-tutorial/" target="_blank">Istio</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/quarkus-tutorial/" target="_blank">Quarkus</a>
            <a class="navbar-item" href="https://redhat-developer-demos.github.io/knative-tutorial/" target="_blank">Knative</a>
            <a class="navbar-item" href="https://redhat-scholars.github.io/tekton-tutorial/" target="_blank">Tekton</a>
          </div>
--->
      </div>
    </div>
  </nav>
</header><div class="body">
<div class="nav-container" data-component="acm-workshop" data-version="4.16">
  <aside class="nav">
    <div class="panels">
<div class="nav-panel-menu is-active" data-panel="menu">
  <nav class="nav-menu">
    <h3 class="title"><a href="index.html" class=" query-params-link">Clusters and Governance</a></h3>
<ul class="nav-list">
  <li class="nav-item" data-depth="0">
<ul class="nav-list">
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="001_accessing_ACM.html">ACM &amp; AWS</a>
<ul class="nav-list">
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="002_cluster_lifecycle.html">Cluster lifecycle</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="003_create_cluster.html">Create cluster</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="004_adding_a_cluster_to_ACM.html">Adding a cluster to ACM</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <button class="nav-item-toggle"></button>
    <a class="nav-link" href="006_hcp_introduction.html">HCP Introduction</a>
<ul class="nav-list">
  <li class="nav-item is-current-page" data-depth="2">
    <a class="nav-link" href="007_explore_environment.html">Explore HCP Environment</a>
  </li>
  <li class="nav-item" data-depth="2">
    <a class="nav-link" href="008_deploy_cluster.html">Deploy HCP cluster</a>
  </li>
</ul>
  </li>
  <li class="nav-item" data-depth="1">
    <a class="nav-link" href="005_governance.html">Governance</a>
  </li>
</ul>
  </li>
</ul>
  </nav>
</div>
<div class="nav-panel-explore" data-panel="explore">
  <div class="context">
    <span class="title">Clusters and Governance</span>
    <span class="version">4.16</span>
  </div>
  <ul class="components">
    <li class="component is-current">
      <span class="title">Clusters and Governance</span>
      <ul class="versions">
        <li class="version is-current is-latest">
          <a href="index.html">4.16</a>
        </li>
      </ul>
    </li>
  </ul>
</div>
    </div>
  </aside>
</div>
<main class="article">
<div class="toolbar" role="navigation">
<button class="nav-toggle"></button>
  <a href="index.html" class="home-link"></a>
<nav class="breadcrumbs" aria-label="breadcrumbs">
  <ul>
    <li><a href="index.html">Clusters and Governance</a></li>
    <li><a href="006_hcp_introduction.html">HCP Introduction</a></li>
    <li><a href="007_explore_environment.html">Explore HCP Environment</a></li>
  </ul>
</nav>
  <div class="edit-this-page"><a href="file:///Users/mroberts/data/git-repos/acm-workshop/documentation/modules/ROOT/pages/007_explore_environment.adoc">Edit this Page</a></div>
</div>
  <div class="content">
<article class="doc">
<h1 class="page">Deploying Clusters using Hosted Control Planes</h1>
<div class="sect1">
<h2 id="_exploring_your_environment"><a class="anchor" href="#_exploring_your_environment"></a>Exploring your Environment</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Let&#8217;s explore what has been set up in the environment.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Log into the bastion VM using the provided SSH command and password.</p>
<div class="listingblock">
<div class="title">Example (use your own URL)</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-sh hljs" data-lang="sh">ssh lab-user@bastion.mark.sandbox2651.opentlc.com</code></pre>
</div>
</div>
</li>
<li>
<p>On the bastion VM examine the hub cluster:</p>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get nodes</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-texinfo hljs" data-lang="texinfo">NAME                                         STATUS   ROLES                  AGE    VERSION
ip-10-0-145-251.us-east-2.compute.internal   Ready    control-plane,master   103m    v1.27.6+b49f9d1
ip-10-0-190-177.us-east-2.compute.internal   Ready    worker                 98m     v1.27.6+b49f9d1
ip-10-0-193-147.us-east-2.compute.internal   Ready    control-plane,master   103m    v1.27.6+b49f9d1
ip-10-0-202-20.us-east-2.compute.internal    Ready    control-plane,master   103m    v1.27.6+b49f9d1
ip-10-0-227-190.us-east-2.compute.internal   Ready    worker                 98m     v1.27.6+b49f9d1
ip-10-0-227-213.us-east-2.compute.internal   Ready    worker                 97m     v1.27.6+b49f9d1</code></pre>
</div>
</div>
</li>
<li>
<p>You will see that your hub cluster has three control plane nodes (<code>master, control-plane</code>) and three worker nodes (<code>worker</code>).</p>
</li>
<li>
<p>Validate that the <code>MultiClusterHub</code> (RHACM) is deployed and ready:</p>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get multiclusterhub -n open-cluster-management</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-texinfo hljs" data-lang="texinfo">NAME              STATUS    AGE
multiclusterhub   Running   81m</code></pre>
</div>
</div>
</li>
<li>
<p>All hosted control plane configuration is stored in a Kubernetes custom resource called <code>HostedCluster</code> in the project <code>local-cluster</code>. Additionally to be managed by RHACM there is also a cluster-wide custom resource called <code>ManagedCluster</code>.</p>
<div class="paragraph">
<p>Examine the hosted cluster that has already been predeployed for you.</p>
</div>
<div class="paragraph">
<p>Switch to the project <code>local-cluster</code></p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project local-cluster</code></pre>
</div>
</div>
</li>
<li>
<p>Get a list of hosted clusters:</p>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get hostedcluster</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-texinfo hljs" data-lang="texinfo">NAME          VERSION   KUBECONFIG                     PROGRESS    AVAILABLE   PROGRESSING   MESSAGE
development   4.14.3    development-admin-kubeconfig   Completed   True        False         The hosted control plane is available</code></pre>
</div>
</div>
<div class="admonitionblock note">
<table>
<tr>
<td class="icon">
<i class="fa icon-note" title="Note"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If your environment just finished provisioning you may see that the hosted cluster is still progressing. In that case the output will look something like this:</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-texinfo hljs" data-lang="texinfo">NAMESPACE       NAME          VERSION   KUBECONFIG                     PROGRESS   AVAILABLE   PROGRESSING   MESSAGE
local-cluster   development             development-admin-kubeconfig   Partial    True        False         The hosted control plane is available</code></pre>
</div>
</div>
<div class="paragraph">
<p>In that case wait until the hosted cluster shows that Progress is <strong>Completed</strong> and the hosted cluster is <strong>Available</strong>.</p>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Examine the hosted cluster:</p>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get hc development -o yaml</code></pre>
</div>
</div>
</li>
<li>
<p>You will see <strong>a lot</strong> of information about this cluster. Under <code>Spec:</code> note the following items:</p>
<div class="ulist">
<ul>
<li>
<p><strong>dns</strong>: Note the base domain for your hosted cluster as well as public and private Route53 zone IDs.</p>
</li>
<li>
<p><strong>etcd</strong>: You will see that the ETCD storage is backed by a <code>PersistentVolumeClaim</code> on the hub cluster using <code>gp3-csi</code> as the Kubernetes storage class.</p>
</li>
<li>
<p><strong>networking</strong>: You will see the various <code>CIDR</code> blocks for IP addresses for the cluster. You will also see that the network type for this environment has been set to <code>OVNKubernetes</code>.</p>
</li>
<li>
<p><strong>platform / aws</strong>: Properties about the hosting platform (only AWS is supported in the Tech Preview). You will see that your cluster has been deployed in the <code>us-west-2a</code> zone in the region <code>us-west-2</code>. Note that this is only true for worker nodes and networking infrastructure like AWS Elastic Load Balancers. The control plane is entirely running as pods on the hub cluster. We will explore that a little bit later.</p>
</li>
<li>
<p><strong>release / Image</strong>: The OpenShift release that was installed.</p>
</li>
<li>
<p><strong>services</strong>: which components of OpenShift have been set up with which properties.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Under the <code>status:</code> section scroll down past all the conditions messages and note the following items:</p>
<div class="ulist">
<ul>
<li>
<p><strong>controlPlaneEndpoint</strong>: the API server URL and port for your cluster</p>
</li>
<li>
<p><strong>kubeadminPassword / name</strong>: The name of the secret in the <code>local-cluster</code> namespace containing the password for the <code>kubeadmin</code> user.</p>
</li>
<li>
<p><strong>kubeconfig / name</strong>: The name of the secret in the <code>local-cluster</code> namespace containing the kubeconfig YAML file for <code>system:admin</code> for your cluster.</p>
</li>
</ul>
</div>
</li>
<li>
<p>Switch to the project <code>local-cluster-development</code> which holds all the resources for this <code>development</code> cluster.</p>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc project local-cluster-development</code></pre>
</div>
</div>
</li>
<li>
<p>List the pods in this project:</p>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get pod</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-texinfo hljs" data-lang="texinfo">NAME                                                  READY   STATUS    RESTARTS   AGE
aws-ebs-csi-driver-controller-56b6858765-pv8d8        7/7     Running   0          73m
aws-ebs-csi-driver-operator-85f48c697b-dszpc          1/1     Running   0          73m
capi-provider-64dd9bf548-rshn7                        2/2     Running   0          75m
catalog-operator-6ff9bdd8bc-lv26h                     2/2     Running   0          74m
certified-operators-catalog-5869f6c754-dxvk9          1/1     Running   0          74m
cloud-network-config-controller-84bcc86dbd-zstcg      3/3     Running   0          73m
cluster-api-6cbd6b955b-4b8mz                          1/1     Running   0          75m
cluster-autoscaler-7c69b647fc-tvmhz                   1/1     Running   0          75m
cluster-image-registry-operator-57d767bb46-5hj8l      3/3     Running   0          74m
cluster-network-operator-5d85cdfc7c-nhswf             1/1     Running   0          74m
cluster-node-tuning-operator-7f9f54ffd8-47bf4         1/1     Running   0          74m
cluster-policy-controller-545d498565-5vq5v            1/1     Running   0          74m
cluster-storage-operator-6c7cdf4b7f-gjdd2             1/1     Running   0          74m
cluster-version-operator-644b55b6dd-rz8nz             1/1     Running   0          74m
community-operators-catalog-5cb87df8fc-tsgvw          1/1     Running   0          74m
control-plane-operator-5fd4dddd44-x8267               2/2     Running   0          75m
csi-snapshot-controller-775b8c9fbf-5jfj4              1/1     Running   0          73m
csi-snapshot-controller-operator-859698d7f4-vdgjt     1/1     Running   0          74m
csi-snapshot-webhook-55d6cdbf57-cxs8j                 1/1     Running   0          73m
dns-operator-88679d75c-r74zq                          1/1     Running   0          74m
etcd-0                                                2/2     Running   0          75m
hosted-cluster-config-operator-84479c79dd-llc5g       1/1     Running   0          74m
ignition-server-66bd9c4b67-gwxr6                      1/1     Running   0          75m
ingress-operator-5f7d8445ff-44j95                     3/3     Running   0          74m
konnectivity-agent-77ff99dbcc-fbmm2                   1/1     Running   0          75m
konnectivity-server-6cc6c57656-5zj29                  1/1     Running   0          75m
kube-apiserver-6c558b89d4-xqwlv                       5/5     Running   0          75m
kube-controller-manager-5d985b6684-f96ct              2/2     Running   0          68m
kube-scheduler-6498cb9547-gt7sd                       1/1     Running   0          74m
machine-approver-5f87cf4475-8q75x                     1/1     Running   0          75m
multus-admission-controller-77469fb8f9-npgf7          2/2     Running   0          72m
oauth-openshift-58cd699d6f-f2ktb                      2/2     Running   0          73m
olm-operator-d6c96d8f8-mpqdd                          2/2     Running   0          74m
openshift-apiserver-56f569b698-k6gnb                  2/2     Running   0          68m
openshift-controller-manager-5d6f45b47b-f495d         1/1     Running   0          74m
openshift-oauth-apiserver-586778cfd8-4pbhv            1/1     Running   0          74m
openshift-route-controller-manager-75764df6f7-qm6bt   1/1     Running   0          74m
ovnkube-master-0                                      7/7     Running   0          72m
packageserver-654c444b98-q7hgl                        2/2     Running   0          74m
redhat-marketplace-catalog-5d98bc6c76-nv7qv           1/1     Running   0          74m
redhat-operators-catalog-5f4f546446-tdlss             1/1     Running   0          40m</code></pre>
</div>
</div>
</li>
<li>
<p>Note all the pods that make up a cluster&#8217;s control plane: etcd, api servers, various cluster operators, Operator Lifecycle Manager pods etc.</p>
</li>
<li>
<p>Also note that this cluster was set up with <code>SingleRedundancy</code> - meaning that there is only one pod for each control plane component - for example the API Server or <code>etcd</code> StatefulSet.</p>
</li>
</ol>
</div>
<div class="sect2">
<h3 id="_managed_cluster"><a class="anchor" href="#_managed_cluster"></a>Managed Cluster</h3>
<div class="paragraph">
<p>The hosted cluster is managed by the <code>MultiClusterEngine</code> operator. To add the managed cluster to Red Hat Advanced Cluster Manager for Kubernetes it has to have a corresponding <code>ManagedCluster</code> resource.</p>
</div>
<div class="paragraph">
<p>For your environment this managed cluster has already been configured. Let&#8217;s take a moment to examine what has been set up.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>List the managed clusters that are available on your hub cluster. Managed clusters are cluster wide resources so you don&#8217;t need to specify a namespace.</p>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get managedclusters</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-texinfo hljs" data-lang="texinfo">NAME            HUB ACCEPTED   MANAGED CLUSTER URLS                                                                         JOINED   AVAILABLE   AGE
development     true           https://a3ec8aa1e521d4fbd8fb24881828fe82-13e768b6e6dd55bc.elb.us-east-2.amazonaws.com:6443   True     True        76m
local-cluster   true           https://api.cluster-p6mj8.sandbox2651.opentlc.com:6443                                       True     True        80m</code></pre>
</div>
</div>
</li>
<li>
<p>There are two managed clusters available: <code>local-cluster</code> - which is your hub cluster - and <code>development</code> which is the small development cluster that has already been pre-deployed.</p>
<div class="paragraph">
<p>Examine the development managed cluster:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get managedcluster development -o yaml</code></pre>
</div>
</div>
</li>
<li>
<p>Note the following properties:</p>
<div class="ulist">
<ul>
<li>
<p><code>metadata.labels</code>: These are all the labels for the managed cluster that you can use to assign workloads to clusters. Note the <code>cloud</code>, <code>name</code> and <code>vendor</code> labels. These have been created automatically when the cluster was imported. The labels <code>guid</code>, <code>rhdp_type</code> and <code>rhdp_usage</code> were set by the logic that deployed the environment.</p>
</li>
<li>
<p><code>status.allocatable</code> and <code>status.capacity</code> tell you about the resource state of the managed cluster.</p>
</li>
<li>
<p><code>status.clusterClaims</code> has more information about the cluster. Most importantly you will find the URL for the OpenShift console under <code>consoleurl.cluster.open-cluster-management.io</code>.</p>
</li>
</ul>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Every time you create another managed cluster you will need to create the managed cluster custom resource to import the cluster into RHACM.</p>
</div>
</div>
<div class="sect2">
<h3 id="_worker_nodes"><a class="anchor" href="#_worker_nodes"></a>Worker Nodes</h3>
<div class="paragraph">
<p>The only additonal Node VMs (or in our case AWS EC2 Instances) that were created are for the worker nodes.</p>
</div>
<div class="paragraph">
<p>When deploying a cluster with a hosted control plane you can specify over how many AWS availability zones you want to spread your cluster and how many worker nodes to deploy into each availability zones. For each availablity zone the operator will create one <code>NodePool</code> to reflect the worker nodes in that zone.</p>
</div>
<div class="paragraph">
<p>This cluster was configured in only one AWS availability zone (<code>us-west-2a</code>) with 1 worker instance in each.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Examine the <code>NodePool</code> that got created (these objects live in the <code>local-cluster</code> project):</p>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get nodepools -n local-cluster</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-texinfo hljs" data-lang="texinfo">NAME                     CLUSTER       DESIRED NODES   CURRENT NODES   AUTOSCALING   AUTOREPAIR   VERSION   UPDATINGVERSION   UPDATINGCONFIG   MESSAGE
development-us-west-2a   development   1               1               False         True         4.14.3</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will see that there is only one <code>NodePool</code>, that it is supposed to have one worker node and that one worker node is available.</p>
</div>
<div class="paragraph">
<p>You will also see that autoscaling is disabled for this node pool and that auto repair is enabled. And finally you will see the OpenShift version for these worker nodes.</p>
</div>
</li>
<li>
<p>Examine the <code>Machine</code> object that got created for your worker node. Note that this is a <strong>different</strong> custom resource than what you may be used to from the OpenShift Machine API. This <code>Machine</code> object is actually in the resource group <code>cluster.x-k8s.io/v1beta1</code>. So to specify that you want to see the objects from that resource group you need to specify that when running the <code>oc get</code> command.</p>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get machine.cluster</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-texinfo hljs" data-lang="texinfo">NAME                                      CLUSTER     NODENAME                                     PROVIDERID                              PHASE     AGE   VERSION
development-us-west-2a-66485f7756-6bwxz   dev-p6mj8   ip-10-0-135-251.us-west-2.compute.internal   aws:///us-west-2a/i-0a302ed5455e1f44c   Running   78m   4.14.3</code></pre>
</div>
</div>
</li>
<li>
<p>Because this cluster is running on AWS there is also a corresponding <code>AWSMachine</code>:</p>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get awsmachine</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-texinfo hljs" data-lang="texinfo">NAME                           CLUSTER     STATE     READY   INSTANCEID                              MACHINE
development-us-west-2a-7dlbh   dev-p6mj8   running   true    aws:///us-west-2a/i-0a302ed5455e1f44c   development-us-west-2a-66485f7756-6bwxz</code></pre>
</div>
</div>
</li>
<li>
<p>Feel free to dig deeper into both the <code>Machine</code> and <code>AWSMachine</code> objects by looking at the YAML definitions.</p>
</li>
</ol>
</div>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_examine_the_provisioned_cluster"><a class="anchor" href="#_examine_the_provisioned_cluster"></a>Examine the provisioned cluster</h2>
<div class="sectionbody">
<div class="paragraph">
<p>Now that you have investigated how cluster definition has been created you can examine the actual deployed cluster.</p>
</div>
<div class="paragraph">
<p>The cluster that has been created is called <strong>development</strong>. In order to connect to this cluster you will need a <code>kubeconfig</code> file.</p>
</div>
<div class="paragraph">
<p>As you have previously seen the password for the <code>kubeadmin</code> user and the <code>kubeconfig</code> configuration are available as a secrets in the hub cluster&#8217;s namespace - in our case this is the <code>local-cluster</code> namespace.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Retrieve the name of the secret holding the kubeadmin password from the hosted cluster resource:</p>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get hc development -n local-cluster -o json | jq -r .status.kubeadminPassword.name</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-texinfo hljs" data-lang="texinfo">development-kubeadmin-password</code></pre>
</div>
</div>
<div class="admonitionblock tip">
<table>
<tr>
<td class="icon">
<i class="fa icon-tip" title="Tip"></i>
</td>
<td class="content">
<div class="paragraph">
<p>If you get an error that <code>jq</code> is not installed then run the following steps to install it:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">sudo dnf -y install jq</code></pre>
</div>
</div>
</td>
</tr>
</table>
</div>
</li>
<li>
<p>Retrieve the name of the secret holding the kubeconfig YAML file from the hosted cluster resource:</p>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get hc development -n local-cluster -o json | jq -r .status.kubeconfig.name</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-texinfo hljs" data-lang="texinfo">development-admin-kubeconfig</code></pre>
</div>
</div>
</li>
<li>
<p>Get the password for the <code>kubeadmin</code> user:</p>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get secret $(oc get hc development -n local-cluster -o json | jq -r .status.kubeadminPassword.name) -n local-cluster --template='{{ .data.password }}' | base64 -d ; echo</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-texinfo hljs" data-lang="texinfo">5hU9W-kUErN-TGuX6-xHpeA</code></pre>
</div>
</div>
</li>
<li>
<p>Get the kubeconfig configuration for the <code>system:admin</code> user:</p>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get secret $(oc get hc development -n local-cluster -o json | jq -r .status.kubeconfig.name) -n local-cluster --template='{{ .data.kubeconfig }}' | base64 -d ; echo</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-texinfo hljs" data-lang="texinfo">apiVersion: v1
clusters:
- cluster:
    certificate-authority-data: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURFRENDQWZpZ0F3SUJBZ0lJR2ducDhWVEdScGt3RFFZSktvWklodmNOQVFFTEJRQXdKakVTTUJBR0ExVUUKQ3hNSmIzQmxibk5vYVdaME1SQXdEZ1lEVlFRREV3ZHliMjkwTFdOaE1CNFhEVEl5TVRBeU9ERTFOREkxTkZvWApEVE15TVRBeU5URTFOREkxTkZvd0pqRVNNQkFHQTFVRUN4TUpiM0JsYm5Ob2FXWjBNUkF3RGdZRFZRUURFd2R5CmIyOTBMV05oTUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUEzbVI1LzFmdWRiNlQKSjNueVBJNmphUDNsSzgvYURHV3VhMnMyNmVUNWJ5RnJ6ZW01YzJTS2tvWHMvYzd3N1kzOWVReG43eVFLWmpiNAo1dk1qajM2OEpGdDE4TG5HNnQ0SFRlZUM2YVAzK1pXZ2ZhOUZ2KzcrRDcvdUJQbkxoK2tIK1gycXVXMmlxTktjCm80Y25EV3ZUWnVJT1BSNFo0T0Zxc3VWcEV1OFZMQmZibHRCOTNGVTJTRHEwUzlzemtPb3VuMmhjcjE3ajBsVXAKWnk1enFseGsvU0ZKbklneXhDVEdsZVhOS0ZFOEpYZnVQeXpKQUNFVHZ3U0VRc2tNblBqZkxYaGtDWFNBTXNRYQp3anl6ZGxEVDFhRCszMlRodFFCQ25xbHQ2eGNKM2tXQld4Qnh3M3FSVCtwSEF3MVVEQlg1SGJnbFdMUk81eVlXCnFvelBzRmVPdlFJREFRQUJvMEl3UURBT0JnTlZIUThCQWY4RUJBTUNBcVF3RHdZRFZSMFRBUUgvQkFVd0F3RUIKL3pBZEJnTlZIUTRFRmdRVVZyTUxqalhmZVNzTkZrMDFoSWYxSzdla0Y3NHdEUVlKS29aSWh2Y05BUUVMQlFBRApnZ0VCQUtqQXFPK00zaEFoYml5MlJITWgrdVRQdXcyby83Qjh6eFVZaTBwZjRnMVlrSnV5enBUVC9Rdy9lcGhYClZVNVlYS3NUNW5CeFhGWHNiaGhMNHA3a3had2orU2lBQW1OMzdsbjUxTjFBczI0ZlZZODdhQnFrenZuaEYxdksKQXhiN2hreDdiaDQxOU5Jc0VHVlN6SUlORG8ydlkxWnNJdnJKeHhobW5BUkpja1lxVTBJVytpZUc0MkNreGdMTwprNEV2UzZEOVpyRHdMWlRuR2Juck9Dcis1dmI2ZS9HZVI1OHVnRnRFZzBnN0RJRlVmMUloK216ZzBJY2VCMkxLCll5VjNWZmF3eGRoZjZwS3VYcFlFcTllQmNjU3hLaW1JdHhQeG1TK2cwdU0xL2loUUQ4NTVCQXVqRDZYSTNsYi8KOGdZL3lnRm16dTdsd0hNaFF4WGUxZWlzL2l3PQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
    server: https://a3ec8aa1e521d4fbd8fb24881828fe82-13e768b6e6dd55bc.elb.us-east-2.amazonaws.com:6443
  name: cluster

  [... output omitted ...]</code></pre>
</div>
</div>
</li>
<li>
<p>Now luckily the environment already has this information available on your bastion VM so you don&#8217;t have to remember the password or create the kubeconfig file.</p>
<div class="paragraph">
<p>Set your <code>KUBECONFIG</code> environment variable to the kubeconfig file that has been set up on your system:</p>
</div>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">export KUBECONFIG=$HOME/.kube/development.kubeconfig</code></pre>
</div>
</div>
</li>
<li>
<p>Now explore the <code>development</code> cluster:</p>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get nodes</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-texinfo hljs" data-lang="texinfo">NAME                                         STATUS   ROLES    AGE   VERSION
ip-10-0-135-251.us-west-2.compute.internal   Ready    worker   75m   v1.27.6+b49f9d1</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that there is only one <code>worker</code> nodes, no <code>control-plane</code> nodes. That&#8217;s because the control plane for this cluster is hosted as pods on the hub cluster as you previously explored.</p>
</div>
</li>
<li>
<p>Explore the cluster operators:</p>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc get co</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre class="highlightjs highlight nowrap"><code class="language-texinfo hljs" data-lang="texinfo">NAME                                       VERSION   AVAILABLE   PROGRESSING   DEGRADED   SINCE   MESSAGE
console                                    4.14.3    True        False         False      71m
csi-snapshot-controller                    4.14.3    True        False         False      79m
dns                                        4.14.3    True        False         False      74m
image-registry                             4.14.3    True        False         False      73m
ingress                                    4.14.3    True        False         False      73m
insights                                   4.14.3    True        False         False      75m
kube-apiserver                             4.14.3    True        False         False      79m
kube-controller-manager                    4.14.3    True        False         False      79m
kube-scheduler                             4.14.3    True        False         False      79m
kube-storage-version-migrator              4.14.3    True        False         False      74m
monitoring                                 4.14.3    True        False         False      72m
network                                    4.14.3    True        False         False      79m
node-tuning                                4.14.3    True        False         False      75m
openshift-apiserver                        4.14.3    True        False         False      79m
openshift-controller-manager               4.14.3    True        False         False      79m
openshift-samples                          4.14.3    True        False         False      73m
operator-lifecycle-manager                 4.14.3    True        False         False      78m
operator-lifecycle-manager-catalog         4.14.3    True        False         False      79m
operator-lifecycle-manager-packageserver   4.14.3    True        False         False      79m
service-ca                                 4.14.3    True        False         False      75m
storage                                    4.14.3    True        False         False      75m</code></pre>
</div>
</div>
<div class="paragraph">
<p>Note that there a quite a few less cluster operators on a cluster with a hosted control plane than on a regular OpenShift cluster. This is of course because the control plane is not managed by the cluster operators but by RHACM.</p>
</div>
</li>
<li>
<p>Get the URL of the OpenShift Console:</p>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc whoami --show-console</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-texinfo hljs" data-lang="texinfo">https://console-openshift-console.apps.development.p6mj8.sandbox2651.opentlc.com</code></pre>
</div>
</div>
</li>
<li>
<p>In a web browser navigate to this URL and log in as <code>kubeadmin</code> using the kubeadmin password you retrieved earlier. You can also find this kubeadmin password by running the following command:</p>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">cat $HOME/.kube/development.kubeadmin-password; echo</code></pre>
</div>
</div>
<div class="paragraph">
<p>You will need accept the certificate warning twice - this is because this cluster is a vanilla OpenShift cluster without any customizations like certificates or authentication.</p>
</div>
</li>
<li>
<p>Navigate around the managed cluster and notice that it looks just like a regular OpenShift Cluster.</p>
</li>
<li>
<p>Close the console browser window and switch back to your hub cluster by unsetting the <code>KUBECONFIG</code> variable.</p>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">unset KUBECONFIG</code></pre>
</div>
</div>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_explore_the_hub_cluster_console"><a class="anchor" href="#_explore_the_hub_cluster_console"></a>Explore the Hub Cluster Console</h2>
<div class="sectionbody">
<div class="paragraph">
<p>The last section in this introductory lab is to examine the hub cluster and the multi cluster console.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Retrieve the Console URL (or refer to the e-mail you got when you provisioned the environment).</p>
<div class="listingblock console-input">
<div class="content">
<pre class="highlightjs highlight"><code class="language-bash hljs" data-lang="bash">oc whoami --show-console</code></pre>
</div>
</div>
<div class="listingblock">
<div class="title">Sample Output</div>
<div class="content">
<pre class="highlightjs highlight"><code class="language-texinfo hljs" data-lang="texinfo">https://console-openshift-console.apps.cluster-p6mj8.sandbox2651.opentlc.com</code></pre>
</div>
</div>
</li>
<li>
<p>Open this URL in a browser and log into the console using the <code>admin</code> user and the password from the welcome e-mail or the Demo system service information page.</p>
</li>
<li>
<p>Notice that in the top left corner you see a drop down menu that reads <strong>local-cluster</strong>. This signifies that you are operating on the local cluster - your hub cluster.</p>
</li>
<li>
<p>Click the <strong>local-cluster</strong> dropdown and select <strong>All Clusters</strong>. This opens the (simplified version of the) Red Hat Advanced Cluster Management for Kubernetes console.</p>
</li>
<li>
<p>If not already there click on <strong>Infrastructure</strong> on the left and then select <strong>Clusters</strong>. You will see that you have two clusters, the <strong>local-cluster</strong> which is also the <strong>Hub</strong> cluster and the <strong>development</strong> cluster that uses <strong>Hypershift</strong> as its infrastructure.</p>
</li>
<li>
<p>Click on the <strong>development</strong> cluster and explore the information available. Note that on the <strong>Nodes</strong> tab you also see the one worker node that has been provisioned.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_next_steps"><a class="anchor" href="#_next_steps"></a>Next steps</h2>
<div class="sectionbody">
<div class="paragraph">
<p>This concludes the exploratory section of this lab.</p>
</div>
<div class="paragraph">
<p>Follow <a href="https://github.com/redhat-cop/openshift-lab-origin/blob/master/HyperShift_Lab/Deploy_Cluster.adoc">Deploy a cluster using HyperShift</a> to deploy a new cluster into your environment using HyperShift.</p>
</div>
</div>
</div>
</article>
<aside class="toc sidebar" data-title="Contents" data-levels="2">
  <div class="toc-menu"></div>
</aside>
  </div>
</main>
</div>
<footer class="footer">
  <a class="rhd-logo" href="https://developers.redhat.com" target="_blank"></div>
</footer>
<script src="../../_/js/vendor/clipboard.js"></script>
<script src="../../_/js/site.js"></script>
<script async src="../../_/js/vendor/highlight.js"></script>
  </body>
</html>
